<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Self-Learning Chess AI</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; background: #1a1a1a; font-family: sans-serif; display: flex; justify-content: center; align-items: center; }
    #game { width: 100vmin; height: 100vmin; display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); border: 4px solid #fff; }
    .square {
      width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      font-size: 3vmin; cursor: pointer;
    }
    .light { background-color: #f0d9b5; }
    .dark { background-color: #b58863; }
    .highlight { outline: 4px solid yellow; }
    #status { position: absolute; top: 10px; color: white; font-size: 1.5em; text-align: center; width: 100%; }
  </style>
</head>
<body>
  <div id="status">Loading...</div>
  <div id="game"></div>
  <script>
    const gameEl = document.getElementById("game");
    const statusEl = document.getElementById("status");

    let board = [];
    let selected = null;
    let turn = "w"; // 'w' for white (human), 'b' for black (AI)

    const PIECES = {
      w: { K: '♔', Q: '♕', R: '♖', B: '♗', N: '♘', P: '♙' },
      b: { K: '♚', Q: '♛', R: '♜', B: '♝', N: '♞', P: '♟' },
    };

    function initBoard() {
      const empty = () => ({ piece: null, color: null });
      board = Array(8).fill(null).map(() => Array(8).fill(null).map(empty));
      const setup = (row, color) => {
        board[row] = [
          { piece: 'R', color }, { piece: 'N', color }, { piece: 'B', color }, { piece: 'Q', color },
          { piece: 'K', color }, { piece: 'B', color }, { piece: 'N', color }, { piece: 'R', color }
        ];
        board[color === 'w' ? 6 : 1] = Array(8).fill({ piece: 'P', color });
      };
      setup(0, 'b');
      setup(7, 'w');
    }

    function renderBoard() {
      gameEl.innerHTML = "";
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const square = document.createElement("div");
          square.className = `square ${(x + y) % 2 === 0 ? "light" : "dark"}`;
          square.dataset.x = x;
          square.dataset.y = y;

          const { piece, color } = board[y][x];
          if (piece) square.textContent = PIECES[color][piece];

          square.addEventListener("click", () => onSquareClick(x, y));

          if (selected && selected.x === x && selected.y === y)
            square.classList.add("highlight");

          gameEl.appendChild(square);
        }
      }
      statusEl.textContent = `${turn === 'w' ? "Your" : "AI"} turn`;
    }

    function onSquareClick(x, y) {
      if (turn !== 'w') return;
      const clicked = board[y][x];

      if (selected) {
        if (isLegalMove(selected.x, selected.y, x, y)) {
          movePiece(selected.x, selected.y, x, y);
          turn = 'b';
          selected = null;
          renderBoard();
          setTimeout(aiMove, 400);
          return;
        }
        selected = null;
      } else if (clicked.color === 'w') {
        selected = { x, y };
      }
      renderBoard();
    }

    function movePiece(fromX, fromY, toX, toY) {
      board[toY][toX] = board[fromY][fromX];
      board[fromY][fromX] = { piece: null, color: null };
    }

    function isLegalMove(fromX, fromY, toX, toY) {
      const moving = board[fromY][fromX];
      const target = board[toY][toX];
      if (!moving.piece || moving.color !== turn) return false;
      if (target.color === turn) return false;
      return true; // basic validation — can add full chess rules later
    }

    function aiMove() {
      // basic AI: choose a random valid move
      const moves = [];
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const cell = board[y][x];
          if (cell.color === 'b') {
            for (let ty = 0; ty < 8; ty++) {
              for (let tx = 0; tx < 8; tx++) {
                if (isLegalMove(x, y, tx, ty)) {
                  moves.push({ fromX: x, fromY: y, toX: tx, toY: ty });
                }
              }
            }
          }
        }
      }
      if (moves.length === 0) {
        statusEl.textContent = "AI has no legal moves. You win!";
        return;
      }
      const move = moves[Math.floor(Math.random() * moves.length)];
      movePiece(move.fromX, move.fromY, move.toX, move.toY);
      turn = 'w';
      renderBoard();
    }

    initBoard();
    renderBoard();
  </script>
</body>
</html>
