<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chess AI Learns from Scratch</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 30px; }
    #board { display: grid; grid-template-columns: repeat(8, 60px); margin: auto; }
    .square {
      width: 60px; height: 60px;
      display: flex; justify-content: center; align-items: center;
      font-size: 32px; cursor: pointer;
    }
    .white { background: #f0d9b5; }
    .black { background: #b58863; }
    .highlight { background: #aaf !important; }
    #status { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Chess AI Learns from Scratch</h1>
  <div id="board"></div>
  <div id="status">Initializing...</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script>
    const boardDiv = document.getElementById("board");
    const status = document.getElementById("status");
    const chess = new Chess();
    let selected = null;
    let aiThinking = false;
    let tries = +localStorage.getItem("chessAITries") || 0;

    const PIECES = {
      p: '♟', r: '♜', n: '♞', b: '♝', q: '♛', k: '♚',
      P: '♙', R: '♖', N: '♘', B: '♗', Q: '♕', K: '♔',
    };

    function drawBoard() {
      boardDiv.innerHTML = "";
      const board = chess.board();
      for (let r = 7; r >= 0; r--) {
        for (let c = 0; c < 8; c++) {
          const square = document.createElement("div");
          square.className = "square " + ((r + c) % 2 ? "black" : "white");
          square.dataset.square = "abcdefgh"[c] + (r + 1);
          const piece = board[r][c];
          if (piece) square.textContent = PIECES[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
          boardDiv.appendChild(square);
        }
      }
    }

    function highlightLegalMoves(square) {
      const moves = chess.moves({ square, verbose: true });
      for (const move of moves) {
        const sq = document.querySelector(`[data-square='${move.to}']`);
        if (sq) sq.classList.add("highlight");
      }
    }

    boardDiv.addEventListener("click", (e) => {
      if (aiThinking) return;
      const square = e.target.dataset.square;
      if (!square) return;
      if (selected) {
        const move = chess.move({ from: selected, to: square, promotion: "q" });
        clearHighlights();
        selected = null;
        if (move) {
          drawBoard();
          setTimeout(aiMove, 500);
        }
      } else {
        const piece = chess.get(square);
        if (piece && piece.color === 'w') {
          selected = square;
          highlightLegalMoves(square);
        }
      }
    });

    function clearHighlights() {
      document.querySelectorAll(".highlight").forEach(el => el.classList.remove("highlight"));
    }

    function aiMove() {
      aiThinking = true;
      const moves = chess.moves();
      if (chess.game_over()) {
        status.textContent = "Game Over!";
        chess.reset();
        tries = 0;
        localStorage.removeItem("chessAITries");
        drawBoard();
        return;
      }

      // Trial & error random move AI
      let bestMove = null;
      let bestScore = -Infinity;
      for (let i = 0; i < 20; i++) {
        const move = moves[Math.floor(Math.random() * moves.length)];
        const temp = new Chess(chess.fen());
        temp.move(move);
        const score = evaluate(temp);
        if (score > bestScore) {
          bestScore = score;
          bestMove = move;
        }
      }

      chess.move(bestMove);
      tries++;
      localStorage.setItem("chessAITries", tries);
      drawBoard();
      status.textContent = `Tries: ${tries}`;
      aiThinking = false;
    }

    function evaluate(chessInstance) {
      // Basic evaluation: material count
      const values = { p: 1, n: 3, b: 3, r: 5, q: 9 };
      let score = 0;
      for (const row of chessInstance.board()) {
        for (const piece of row) {
          if (!piece) continue;
          const val = values[piece.type] || 0;
          score += piece.color === 'b' ? val : -val;
        }
      }
      return score;
    }

    drawBoard();
    spawnDelay();

    function spawnDelay() {
      setTimeout(() => {
        if (!chess.turn().includes("b")) return;
        aiMove();
        spawnDelay();
      }, Math.max(2000 - Math.log(tries + 1) * 300, 200)); // speeds up over time
    }
  </script>
</body>
</html>

